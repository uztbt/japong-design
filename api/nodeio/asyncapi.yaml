asyncapi: 2.0.0
info:
  title: Node I/O application.
  version: '0.1.0'
servers:
  us-central:
    url: us-central.japong.yuji.page
    protocol: ws
    description: us-central JaPong node.
  asia-northeast:
    url: asia-northeast.japong.yuji.page
    protocol: ws
    description: asia-northeast JaPong node.
channels:
  commandDict:
    publish:
      summary: Send player inputs to the server.
      operationId: onInputReceived
      message:
        $ref: '#/components/messages/command-dictionary'
  board:
    subscribe:
      summary: Get the latest game status from the server.
      message:
        $ref: '#/components/messages/board'
  gameOver:
    subscribe:
      summary: Get notified when the game is over.
      message:
        $ref: '#/components/messages/gameOver'
  joinedRoom:
    subscribe:
      summary: Get notified about if you successfully joined a room.
      message:
        $ref: '#/components/messages/joinedRoom'
  opponentLeft:
    subscribe:
      summary: Get notified when your opponent left.
      message:
        $ref: '#/components/messages/opponentLeft'
  countDown:
    subscribe:
      summary: Get the seconds until the game starts.
      message:
        $ref: '#/components/messages/countDown'

components:
  messages:
    command-dictionary:
      name: CommandDictionary
      payload:
        type: object
        properties:
          UP:
            type: boolean
          DOWN:
            type: boolean
          LEFT:
            type: boolean
          RIGHT:
            type: boolean
          ENTER:
            type: boolean
          MOVE:
            type: boolean
    board:
      name: Board
      payload:
        type: object
        properties:
          drawables:
            type: array
            items:
              type: object
              properties:
                x:
                  type: integer
                y:
                  type: integer
                w:
                  type: integer
                h:
                  type: integer
          scores:
            type: array
            items:
              type: integer
    gameOver:
      name: GameOver
      payload:
        type: object
        properties:
          scores:
            type: array
            items:
              type: integer
    joinedRoom:
      name: JoinedRoom
      payload:
        type: object
        properties:
          roomNo:
            type: integer
          playerId:
            type: integer
    opponentLeft:
      name: OpponentLeft
      payload:
        type: object
    countDown:
      name: CountDown
      payload:
        type: integer
